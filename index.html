<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบติดตามงานค้าง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
        }

        @media print {
            .no-print {
                display: none !important;
            }

            body {
                -webkit-print-color-adjust: exact;
            }
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen text-slate-800">

    <div class="max-w-5xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <div
            class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
            <div class="flex items-center gap-4">
                <div class="bg-teal-100 p-3 rounded-xl text-teal-600">
                    <i data-lucide="clipboard-list" class="w-8 h-8"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">ระบบติดตามงานค้าง</h1>
                    <p class="text-slate-500 text-sm">ภาคเรียนที่ 2/2567</p>
                </div>
            </div>
            <div class="text-right hidden md:block">
                <div class="text-sm font-bold text-slate-600">ข้อมูล ณ วันที่</div>
                <div id="printDate" class="text-teal-600 font-bold text-lg"></div>
            </div>
        </div>

        <!-- Add Student Form -->
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8 no-print">
            <form id="addStudentForm" class="flex flex-col md:flex-row gap-4 items-end">
                <div class="flex-1 w-full">
                    <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center gap-2">
                        <i data-lucide="user-plus" class="w-4 h-4 text-teal-500"></i>
                        เพิ่มชื่อบุคคล
                    </label>
                    <input type="text" id="studentNameInput"
                        class="w-full p-3 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent transition-all bg-slate-50"
                        placeholder="พิมพ์ชื่อ-นามสกุล แล้วกด Enter...">
                </div>
                <button type="submit"
                    class="bg-teal-600 text-white px-6 py-3 rounded-xl hover:bg-teal-700 transition-colors font-bold shadow-lg shadow-teal-200 flex items-center gap-2 w-full md:w-auto justify-center">
                    <i data-lucide="save" class="w-4 h-4"></i>
                    บันทึก
                </button>
            </form>
        </div>

        <!-- Legend -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-6" id="assignmentLegend">
            <!-- Legend items will be injected here -->
        </div>

        <!-- Main Content Area -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
            <!-- Desktop Table View -->
            <div class="hidden md:block overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr
                            class="bg-slate-50 text-slate-600 text-sm uppercase tracking-wider border-b border-slate-100">
                            <th class="p-4 w-16 text-center font-bold">#</th>
                            <th class="p-4 font-bold">ชื่อ-นามสกุล</th>
                            <!-- เลขงาน 1-7 -->
                            <th class="p-2 border-l text-center">1</th>
                            <th class="p-2 border-l text-center">2</th>
                            <th class="p-2 border-l text-center">3</th>
                            <th class="p-2 border-l text-center">4</th>
                            <th class="p-2 border-l text-center">5</th>
                            <th class="p-2 border-l text-center">6</th>
                            <th class="p-2 border-l text-center">7</th>
                            <th class="p-2 border-l w-64">สรุปสถานะ</th>
                            <th class="no-print w-16"></th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                        <!-- รายชื่อจะถูกเติมที่นี่ -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div class="md:hidden p-4 space-y-4" id="mobileStudentList">
                <!-- Cards will be injected here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 text-center text-slate-400 text-xs pb-20 md:pb-8">
            <p>ระบบติดตามงานค้าง v1.2</p>
        </div>

        <!-- Floating Action Button for Reset -->
        <div class="fixed bottom-4 right-4 no-print z-50">
            <button onclick="resetData()"
                class="bg-slate-800 text-white p-4 rounded-full shadow-xl hover:bg-slate-700 transition-all hover:scale-105 active:scale-95"
                title="ล้างข้อมูลทั้งหมด">
                <i data-lucide="rotate-ccw" class="w-6 h-6"></i>
            </button>
        </div>
    </div>

    <script>
        // ข้อมูลงาน
        const assignments = [
            { id: 1, title: 'งานที่ 1', desc: '(สรุปหลักการ → พร้อม Pitch Deck)' },
            { id: 2, title: 'งานที่ 2', desc: '(ข่าวทั่วไป → พร้อม Pitch Deck)' },
            { id: 3, title: 'งานที่ 3', desc: '(สรุปทฤษฎี → พร้อม Pitch Deck)' },
            { id: 4, title: 'งานที่ 4', desc: '(วาด 9 ช่อง / แบบตัวอย่างนักเรียน)' },
            { id: 5, title: 'งานที่ 5', desc: '(สไลด์รีวิวหนังสั้น → พร้อม Pitch Deck)' },
            { id: 6, title: 'งานที่ 6', desc: '(AI Traffic Brain → พร้อม Pitch Deck)' },
            { id: 7, title: 'งานที่ 7', desc: '(มุมวัฒนธรรม → พร้อม Pitch Deck)' },
        ];

        // ข้อมูลนักเรียนเริ่มต้น
        let students = [
            { id: 1, name: 'ตัวอย่าง: นาย ก.', missing: [] },
            { id: 2, name: 'ตัวอย่าง: นาย ข.', missing: [1, 4] }
        ];

        const STORAGE_KEY = 'student_tracker_data_v1';

        // เริ่มต้นทำงาน
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            lucide.createIcons();
            renderLegend();
            renderAll();
            const dateEl = document.getElementById('printDate');
            if (dateEl) dateEl.innerText = new Date().toLocaleDateString('th-TH');
        });

        // Load/Save Data
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    students = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading data', e);
                }
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(students));
        }

        function resetData() {
            if (confirm('ต้องการล้างข้อมูลทั้งหมดและเริ่มใหม่?')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // ฟอร์มเพิ่มชื่อ
        const addForm = document.getElementById('addStudentForm');
        if (addForm) {
            addForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const input = document.getElementById('studentNameInput');
                const name = input.value.trim();
                if (name) {
                    const newId = students.length > 0 ? Math.max(...students.map(s => s.id)) + 1 : 1;
                    students.push({ id: newId, name: name, missing: [] });
                    saveData();
                    input.value = '';
                    renderAll();
                    renderLegend();
                }
            });
        }

        // ฟังก์ชัน Toggle งานค้าง
        function toggleMissing(studentId, workId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                if (student.missing.includes(workId)) {
                    student.missing = student.missing.filter(id => id !== workId);
                } else {
                    student.missing.push(workId);
                    student.missing.sort((a, b) => a - b);
                }
                saveData();
                renderAll();
                renderLegend();
            }
        }

        // ลบนักเรียน
        function removeStudent(id) {
            if (confirm('ลบรายชื่อนี้?')) {
                students = students.filter(s => s.id !== id);
                saveData();
                renderAll();
                renderLegend();
            }
        }

        // แสดงรายการงานด้านบน
        function renderLegend() {
            const container = document.getElementById('assignmentLegend');
            if (!container) return;
            container.innerHTML = assignments.map(work => {
                const count = students.filter(s => s.missing.includes(work.id)).length;
                const statusClass = count > 0 ? 'bg-rose-50 text-rose-600 border-rose-100' : 'bg-white text-teal-600 border-slate-100';
                return `
                    <div class="p-3 rounded-lg border ${statusClass} text-sm flex justify-between items-center shadow-sm">
                        <div>
                            <span class="font-bold">งานที่ ${work.id}</span>
                            <span class="text-xs ml-1 opacity-80">${work.desc}</span>
                        </div>
                        <span class="text-xs font-bold px-2 py-1 rounded-full ${count > 0 ? 'bg-white' : 'bg-teal-50'}">
                            ${count > 0 ? `ค้าง ${count}` : 'ครบ'}
                        </span>
                    </div>
                `;
            }).join('');
        }

        function renderAll() {
            renderTable();
            renderMobileCards();
            lucide.createIcons();
        }

        // แสดงตาราง (Desktop)
        function renderTable() {
            const tbody = document.getElementById('studentTableBody');
            if (!tbody) return;

            if (students.length === 0) {
                tbody.innerHTML = `<tr><td colspan="11" class="p-8 text-center text-slate-400">เพิ่มรายชื่อนักเรียนด้านบน</td></tr>`;
                return;
            }

            tbody.innerHTML = students.map((s, index) => {
                // Checkboxes
                const checkboxes = assignments.map(a => `
                    <td class="p-2 text-center border-l border-slate-50">
                        <input type="checkbox" 
                            ${s.missing.includes(a.id) ? 'checked' : ''} 
                            onchange="toggleMissing(${s.id}, ${a.id})"
                            class="w-5 h-5 accent-rose-500 cursor-pointer">
                    </td>
                `).join('');

                // Summary
                let summaryHtml = '';
                if (s.missing.length > 0) {
                    summaryHtml = `
                        <div class="text-rose-500 font-bold text-xs mb-1">ค้าง ${s.missing.length} งาน:</div>
                        <ul class="text-[10px] text-slate-600 list-disc list-inside leading-tight">
                            ${s.missing.map(mId => {
                        const work = assignments.find(a => a.id === mId);
                        return `<li><b>งาน ${mId}</b></li>`;
                    }).join('')}
                        </ul>
                    `;
                } else {
                    summaryHtml = `<span class="text-teal-600 text-xs flex items-center gap-1">✓ ครบถ้วน</span>`;
                }

                return `
                    <tr class="border-b border-slate-100 hover:bg-teal-50/20 transition-colors">
                        <td class="p-3 text-center text-slate-400 text-sm">${index + 1}</td>
                        <td class="p-3 font-medium text-slate-700">${s.name}</td>
                        ${checkboxes}
                        <td class="p-3 border-l border-slate-50 align-top">${summaryHtml}</td>
                        <td class="p-3 text-center no-print">
                            <button onclick="removeStudent(${s.id})" class="text-slate-300 hover:text-rose-500"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // แสดงการ์ด (Mobile)
        function renderMobileCards() {
            const container = document.getElementById('mobileStudentList');
            if (!container) return;

            if (students.length === 0) {
                container.innerHTML = `<div class="text-center text-slate-400 py-8">เพิ่มรายชื่อนักเรียนด้านบน</div>`;
                return;
            }

            container.innerHTML = students.map((s, index) => {
                const isComplete = s.missing.length === 0;

                // Work Toggles
                const workToggles = assignments.map(a => {
                    const isMissing = s.missing.includes(a.id);
                    return `
                        <div onclick="toggleMissing(${s.id}, ${a.id})" 
                             class="cursor-pointer p-2 rounded border text-xs flex flex-col items-center justify-center gap-1 transition-all
                             ${isMissing
                            ? 'bg-rose-50 border-rose-200 text-rose-600'
                            : 'bg-slate-50 border-slate-100 text-slate-400 hover:bg-teal-50 hover:text-teal-600'}">
                            <span class="font-bold">${a.id}</span>
                            <div class="w-3 h-3 rounded-full border ${isMissing ? 'bg-rose-500 border-rose-500' : 'bg-white border-slate-300'}"></div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-3">
                                <span class="bg-slate-100 text-slate-500 text-xs font-bold px-2 py-1 rounded">${index + 1}</span>
                                <h3 class="font-bold text-slate-700">${s.name}</h3>
                            </div>
                            <button onclick="removeStudent(${s.id})" class="text-slate-300 hover:text-rose-500">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-2 mb-3">
                            ${workToggles}
                        </div>

                        <div class="text-xs pt-3 border-t border-slate-50 flex justify-between items-center">
                            <span class="text-slate-400">สถานะ:</span>
                            ${isComplete
                        ? '<span class="text-teal-600 font-bold flex items-center gap-1"><i data-lucide="check-circle" class="w-3 h-3"></i> ส่งครบแล้ว</span>'
                        : `<span class="text-rose-500 font-bold">ค้าง ${s.missing.length} งาน</span>`
                    }
                        </div>
                    </div>
                `;
            }).join('');
        }
    </script>
</body>

</html>